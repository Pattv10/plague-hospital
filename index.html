<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plague Hospital Game</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #0f0f0f;
            color: #f3f4f6;
        }
        /* Tailwind-like utility classes */
        .min-h-screen { min-height: 100vh; }
        .bg-gradient-to-b { background-image: linear-gradient(to bottom, var(--tw-gradient-stops)); }
        .from-amber-950 { --tw-gradient-stops: #431407, var(--tw-gradient-to); }
        .to-stone-900 { --tw-gradient-to: #1c1917; }
        .p-6 { padding: 1.5rem; }
        .max-w-6xl { max-width: 72rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .bg-amber-900 { background-color: #782800; }
        .border-4 { border-width: 4px; }
        .border-amber-700 { border-color: #b45309; }
        .rounded-lg { border-radius: 0.5rem; }
        .p-8 { padding: 2rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .text-4xl { font-size: 2.25rem; }
        .font-bold { font-weight: 700; }
        .text-amber-100 { color: #fef3c7; }
        .mb-2 { margin-bottom: 0.5rem; }
        .text-center { text-align: center; }
        .text-lg { font-size: 1.125rem; }
        .text-amber-200 { color: #fde68a; }
        .flex { display: flex; }
        .justify-center { justify-content: center; }
        .gap-8 { gap: 2rem; }
        .mt-4 { margin-top: 1rem; }
        .text-center { text-align: center; }
        .text-amber-300 { color: #facc15; }
        .text-3xl { font-size: 1.875rem; }
        .text-green-400 { color: #4ade80; }
        .bg-stone-800 { background-color: #1f2937; }
        .border-stone-700 { border-color: #374151; }
        .p-6 { padding: 1.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-stone-300 { color: #d1d5db; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .gap-4 { gap: 1rem; }
        .border-stone-600 { border-color: #4b5563; }
        .cursor-pointer { cursor: pointer; }
        .transform { transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .hover\:scale-105:hover { transform: scale(1.05); }
        .hover\:shadow-2xl:hover { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .bg-green-900 { background-color: #166534; }
        .border-green-700 { border-color: #16a34a; }
        .opacity-75 { opacity: 0.75; }
        .items-start { align-items: flex-start; }
        .mb-3 { margin-bottom: 0.75rem; }
        .text-xl { font-size: 1.25rem; }
        .text-stone-400 { color: #9ca3af; }
        .text-sm { font-size: 0.875rem; }
        .inline-block { display: inline-block; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .rounded-full { border-radius: 9999px; }
        .font-bold { font-weight: 700; }
        .mb-3 { margin-bottom: 0.75rem; }
        .items-center { align-items: center; }
        .gap-2 { gap: 0.5rem; }
        .text-stone-300 { color: #d1d5db; }
        .w-full { width: 100%; }
        .mt-4 { margin-top: 1rem; }
        .bg-amber-700 { background-color: #b45309; }
        .hover\:bg-amber-600:hover { background-color: #d97706; }
        .text-amber-100 { color: #fef3c7; }
        .font-bold { font-weight: 700; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .rounded { border-radius: 0.25rem; }
        .transition-colors { transition-property: background-color, border-color, color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .border-2 { border-width: 2px; }
        .border-amber-900 { border-color: #782800; }
        .bg-stone-700 { background-color: #374151; }
        .hover\:bg-stone-600:hover { background-color: #4b5563; }
        .text-stone-100 { color: #f9fafb; }
        .mb-6 { margin-bottom: 1.5rem; }
        .lg\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .space-y-4 { margin-top: 1rem; gap: 1rem; display: flex; flex-direction: column; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .bg-stone-900 { background-color: #111827; }
        .min-h-96 { min-height: 24rem; }
        .bg-amber-950 { background-color: #431407; }
        .border-amber-800 { border-color: #92400e; }
        .p-3 { padding: 0.75rem; }
        .text-amber-200 { color: #fde68a; }
        .mt-4 { margin-top: 1rem; }
        .flex-wrap { flex-wrap: wrap; }
        .gap-2 { gap: 0.5rem; }
        .bg-green-900 { background-color: #166534; }
        .text-green-100 { color: #dcfce7; }
        .border-green-700 { border-color: #16a34a; }
        .text-green-400 { color: #4ade80; }
        .relative { position: relative; }
        .h-96 { height: 24rem; }
        .bg-stone-800 { background-color: #1f2937; }
        .border-stone-700 { border-color: #374151; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .cursor-pointer { cursor: pointer; }
        .hover\:opacity-80:hover { opacity: 0.8; }
        .transition-opacity { transition-property: opacity; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .space-y-3 { margin-top: 0.75rem; gap: 0.75rem; display: flex; flex-direction: column; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .bg-stone-900 { background-color: #111827; }
        .p-2 { padding: 0.5rem; }
        .rounded { border-radius: 0.25rem; }
        .text-right { text-align: right; }
        .bg-stone-800 { background-color: #1f2937; }
        .text-amber-100 { color: #fef3c7; }
        .w-24 { width: 6rem; }
        .border-stone-600 { border-color: #4b5563; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .h-24 { height: 6rem; }
        .text-xs { font-size: 0.75rem; }
        .text-stone-500 { color: #6b7280; }
        .mt-1 { margin-top: 0.25rem; }
        .border-l-4 { border-left-width: 4px; }
        .border-red-600 { border-left-color: #dc2626; }
        .text-amber-400 { color: #fbbf24; }
        .mb-3 { margin-bottom: 0.75rem; }
        .bg-green-950 { background-color: #14532d; }
        .border-green-800 { border-color: #16a34a; }
        .text-green-400 { color: #4ade80; }
        .text-green-100 { color: #dcfce7; }
        .space-y-2 { margin-top: 0.5rem; gap: 0.5rem; display: flex; flex-direction: column; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .text-green-200 { color: #bbf7d0; }
        .flex { display: flex; }
        .items-start { align-items: flex-start; }
        .gap-2 { gap: 0.5rem; }
        .mt-1 { margin-top: 0.25rem; }
        .w-full { width: 100%; }
        .bg-green-700 { background-color: #16a34a; }
        .hover\:bg-green-600:hover { background-color: #15803d; }
        .text-green-100 { color: #dcfce7; }
        .font-bold { font-weight: 700; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .text-xl { font-size: 1.25rem; }
        .border-green-900 { border-color: #14532d; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .justify-center { justify-content: center; }
        .gap-3 { gap: 0.75rem; }
        .bg-green-900 { background-color: #166534; }
        .border-green-700 { border-color: #16a34a; }
        .p-4 { padding: 1rem; }
        .text-center { text-align: center; }
        .text-green-300 { color: #86efac; }
        .mt-2 { margin-top: 0.5rem; }
        /* Severity colors */
        .bg-red-900 { background-color: #7f1d1d; }
        .text-red-100 { color: #fee2e2; }
        .border-red-700 { border-color: #b91c1c; }
        .bg-orange-900 { background-color: #7c2d12; }
        .text-orange-100 { color: #ffeddb; }
        .border-orange-700 { border-color: #c2410c; }
        .bg-yellow-900 { background-color: #713f12; }
        .text-yellow-100 { color: #fef9c3; }
        .border-yellow-700 { border-color: #b45309; }
        .bg-gray-700 { background-color: #374151; }
        .text-gray-100 { color: #f3f4f6; }
        .border-gray-600 { border-color: #4b5563; }
        /* Custom styles for dropdown */
        .dropdown {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        .dropdown-button {
            width: 100%;
            padding: 0.5rem 1rem;
            background-color: #1f2937;
            border: 2px solid #4b5563;
            border-radius: 0.375rem;
            color: #d1d5db;
            font-size: 0.875rem;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dropdown-button:hover {
            background-color: #374151;
            border-color: #6b7280;
        }
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #111827;
            border: 2px solid #4b5563;
            border-radius: 0.375rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            margin-top: 0.25rem;
        }
        .dropdown-item {
            padding: 0.75rem 1rem;
            color: #d1d5db;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .dropdown-item:hover {
            background-color: #1f2937;
        }
        .dropdown-item.selected {
            background-color: #374151;
        }
        .dropdown-item.selected::before {
            content: "‚úì";
            margin-right: 0.5rem;
            color: #4ade80;
        }
        .symptom-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .symptom-tag {
            background-color: #374151;
            color: #fde68a;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
        }
        .symptom-tag-remove {
            margin-left: 0.5rem;
            color: #ef4444;
            cursor: pointer;
        }
        .exam-animation {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(234, 179, 8, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); }
        }
        .examination-intro {
            background-color: #1f2937;
            border-left: 4px solid #fbbf24;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0.5rem;
        }
        .examination-intro h3 {
            color: #fbbf24;
            margin-bottom: 0.75rem;
        }
        .examination-intro p {
            color: #d1d5db;
            margin-bottom: 0.5rem;
        }
        /* New styles for severity assessment and discharge */
        .severity-assessment {
            background-color: #1f2937;
            border: 2px solid #7c2d12;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        .severity-assessment h4 {
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }
        .severity-indicators {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .indicator {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        .indicator.improved {
            background-color: #166534;
            color: #dcfce7;
        }
        .indicator.worsened {
            background-color: #7f1d1d;
            color: #fee2e2;
        }
        .indicator.stable {
            background-color: #1e3a8a;
            color: #dbeafe;
        }
        .decision-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .btn-discharge {
            background-color: #059669;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: 2px solid #065f46;
            cursor: pointer;
            flex: 1;
            text-align: center;
        }
        .btn-discharge:hover {
            background-color: #047857;
        }
        .btn-admit {
            background-color: #b91c1c;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: 2px solid #991b1b;
            cursor: pointer;
            flex: 1;
            text-align: center;
        }
        .btn-admit:hover {
            background-color: #991b1b;
        }
        .discharge-form {
            background-color: #1f2937;
            border: 2px solid #059669;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        .discharge-form h4 {
            color: #34d399;
            margin-bottom: 0.75rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            color: #d1d5db;
            font-size: 0.875rem;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.5rem;
            background-color: #111827;
            border: 1px solid #374151;
            border-radius: 0.375rem;
            color: #f3f4f6;
        }
        .admission-form {
            background-color: #1f2937;
            border: 2px solid #b91c1c;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        .admission-form h4 {
            color: #f87171;
            margin-bottom: 0.75rem;
        }
        .status-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-improved {
            background-color: #065f46;
            color: #dcfce7;
        }
        .status-stable {
            background-color: #1e40af;
            color: #dbeafe;
        }
        .status-worsened {
            background-color: #991b1b;
            color: #fee2e2;
        }
        .treatment-plan {
            background-color: #1f2937;
            border: 2px solid #7c2d12;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        .treatment-plan h4 {
            color: #fbbf24;
            margin-bottom: 0.75rem;
        }
        .treatment-items {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        .treatment-item {
            padding: 0.5rem;
            background-color: #111827;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
        }
        .treatment-item::before {
            content: "‚Ä¢";
            color: #fbbf24;
            margin-right: 0.5rem;
            font-weight: bold;
        }
        /* Discharge notice (opcional, ahora comentado) */
        .discharge-notice {
            background-color: #065f46;
            border: 2px solid #059669;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1rem;
            text-align: center;
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .discharge-notice h3 {
            color: #dcfce7;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .discharge-notice p {
            color: #ecfdf5;
            font-size: 1.125rem;
            margin: 0.5rem 0;
        }
        .discharge-notice .highlight {
            background-color: rgba(34, 197, 94, 0.2);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;
        // Icons as functional components
        const Heart = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
            </svg>
        );
        const Thermometer = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/>
            </svg>
        );
        const Activity = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.48 12H2"/>
            </svg>
        );
        const Stethoscope = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="10" r="3"/>
                <path d="M9.34 12.24a2.5 2.5 0 0 1-.66 1.14A2.5 2.5 0 0 1 7.5 12c0-1.38.62-2.24 1.76-2.92L12 7l4.24 2.08A2.5 2.5 0 0 1 18 12a2.5 2.5 0 0 1-1.18 2.14 2.5 2.5 0 0 1-.66 1.14"/>
            </svg>
        );
        const Syringe = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="m15 2 5 5"/>
            </svg>
        );
        const ClipboardList = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <rect width="8" height="4" x="8" y="2" rx="1" ry="1"/>
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                <path d="M12 11h4"/>
                <path d="M12 16h4"/>
                <path d="M8 11h.01"/>
                <path d="M8 16h.01"/>
            </svg>
        );
        const ArrowLeft = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="m12 19-7-7 7-7"/>
                <path d="M19 12H5"/>
            </svg>
        );
        const Users = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
        );
        const PlagueHospitalGame = () => {
            const [currentScreen, setCurrentScreen] = useState('lobby');
            const [selectedPatient, setSelectedPatient] = useState(null);
            const [treatedPatients, setTreatedPatients] = useState([]);
            const [score, setScore] = useState(0);
            const [examinedAreas, setExaminedAreas] = useState([]);
            const [showVisualExam, setShowVisualExam] = useState(false);
            const [manualVitalSigns, setManualVitalSigns] = useState({
                temp: '',
                pulse: '',
                respRate: '',
                bp: ''
            });
            const [selectedSymptoms, setSelectedSymptoms] = useState([]);
            const [examFindings, setExamFindings] = useState({});
            const [diagnosis, setDiagnosis] = useState('');
            const [showSymptomDropdown, setShowSymptomDropdown] = useState(false);
            const [patientStatus, setPatientStatus] = useState('stable'); // improved, stable, worsened
            const [showDischargeForm, setShowDischargeForm] = useState(false);
            const [showAdmissionForm, setShowAdmissionForm] = useState(false);
            const [dischargeReason, setDischargeReason] = useState('');
            const [followUp, setFollowUp] = useState('');
            const [admissionDiagnosis, setAdmissionDiagnosis] = useState('');
            const [treatmentPlan, setTreatmentPlan] = useState([]);
            // REMOVED: dischargedPatient (no longer needed)

            // All possible symptoms for the dropdown - added "Sin s√≠ntomas"
            const allSymptoms = [
                "Sin s√≠ntomas",
                "Bubones en axilas",
                "Bubones en ingles",
                "Bubones en cuello",
                "Fiebre alta (m√°s de 39¬∞C)",
                "Fiebre moderada (38-39¬∞C)",
                "Fiebre leve (37-38¬∞C)",
                "Escalofr√≠os severos",
                "Debilidad extrema",
                "Manchas negras en piel",
                "Tos con sangre",
                "Dolor de cabeza intenso",
                "N√°useas",
                "Dolor abdominal",
                "V√≥mitos",
                "Confusi√≥n mental",
                "Fatiga",
                "Dolor de garganta",
                "Cianosis",
                "Shock s√©ptico",
                "Malestar general",
                "P√©rdida de apetito",
                "Diarrea con sangre",
                "Erupci√≥n cut√°nea",
                "P√∫stulas",
                "Entumecimiento",
                "P√©rdida de sensibilidad"
            ];

            const patients = [
                {
                    id: 1,
                    name: "Guillaume de Marais",
                    age: 34,
                    gender: "Masculino",
                    occupation: "Comerciante",
                    symptoms: ["Bubones en axilas e ingles", "Fiebre alta (40¬∞C)", "Escalofr√≠os severos", "Debilidad extrema", "Manchas negras en piel"],
                    vitalSigns: { temp: 40.2, pulse: 125, respRate: 28, bp: "90/60" },
                    severity: "cr√≠tico",
                    treatment: ["Antibi√≥ticos IV (Estreptomicina)", "Fluidoterapia", "Aislamiento", "Drenaje de bubones"],
                    prognosis: "Grave - requiere UCI inmediata"
                },
                {
                    id: 2,
                    name: "Marguerite Dubois",
                    age: 28,
                    gender: "Femenino",
                    occupation: "Panadera",
                    symptoms: ["Bubones en cuello", "Fiebre moderada (38.5¬∞C)", "Tos con sangre", "Dolor de cabeza intenso", "N√°useas"],
                    vitalSigns: { temp: 38.7, pulse: 110, respRate: 24, bp: "100/70" },
                    severity: "grave",
                    treatment: ["Antibi√≥ticos IV (Doxiciclina)", "Oxigenoterapia", "Antipir√©ticos", "Aislamiento respiratorio"],
                    prognosis: "Requiere atenci√≥n urgente"
                },
                {
                    id: 3,
                    name: "Pierre Lefebvre",
                    age: 45,
                    gender: "Masculino",
                    occupation: "Herrero",
                    symptoms: ["Fiebre alta (39¬∞C)", "Bubones en ingle", "Dolor abdominal", "V√≥mitos", "Confusi√≥n mental"],
                    vitalSigns: { temp: 39.3, pulse: 118, respRate: 26, bp: "85/55" },
                    severity: "cr√≠tico",
                    treatment: ["Antibi√≥ticos combinados", "Soporte hemodin√°mico", "Monitorizaci√≥n continua", "Sedaci√≥n si agitaci√≥n"],
                    prognosis: "Cr√≠tico - sepsis en desarrollo"
                },
                {
                    id: 4,
                    name: "Anne de Toulouse",
                    age: 19,
                    gender: "Femenino",
                    occupation: "Sirvienta",
                    symptoms: ["Fiebre leve (37.8¬∞C)", "Bub√≥n peque√±o en axila", "Fatiga", "Dolor de garganta"],
                    vitalSigns: { temp: 37.9, pulse: 95, respRate: 20, bp: "110/75" },
                    severity: "moderado",
                    treatment: ["Antibi√≥ticos orales", "Reposo", "Hidrataci√≥n", "Seguimiento cada 6h"],
                    prognosis: "Favorable si se trata r√°pidamente"
                },
                {
                    id: 5,
                    name: "Jean Baptiste",
                    age: 52,
                    gender: "Masculino",
                    occupation: "Granjero",
                    symptoms: ["Bubones m√∫ltiples", "Fiebre muy alta (41¬∞C)", "Tos con esputo sanguinolento", "Cianosis", "Shock s√©ptico"],
                    vitalSigns: { temp: 41.1, pulse: 140, respRate: 32, bp: "70/45" },
                    severity: "cr√≠tico",
                    treatment: ["Resucitaci√≥n con fluidos", "Vasopresores", "Antibi√≥ticos IV urgentes", "Ventilaci√≥n mec√°nica"],
                    prognosis: "Extremadamente grave - mortalidad alta"
                },
                {
                    id: 6,
                    name: "Isabelle Moreau",
                    age: 31,
                    gender: "Femenino",
                    occupation: "Tejedora",
                    symptoms: ["Fiebre moderada (38¬∞C)", "Bub√≥n en ingle derecha", "Malestar general", "P√©rdida de apetito"],
                    vitalSigns: { temp: 38.2, pulse: 102, respRate: 22, bp: "105/68" },
                    severity: "moderado",
                    treatment: ["Antibi√≥ticos IV", "Analg√©sicos", "Monitorizaci√≥n", "Nutrici√≥n"],
                    prognosis: "Buena con tratamiento temprano"
                },
                {
                    id: 7,
                    name: "Thomas Leblanc",
                    age: 25,
                    gender: "Masculino",
                    occupation: "Aprendiz",
                    symptoms: [],
                    vitalSigns: { temp: 36.8, pulse: 78, respRate: 16, bp: "120/80" },
                    severity: "leve",
                    treatment: ["Reposo", "Hidrataci√≥n", "Control sintom√°tico"],
                    prognosis: "Favorable - alta domiciliaria"
                }
            ];

            const getSeverityColor = (severity) => {
                switch(severity) {
                    case 'cr√≠tico': return 'bg-red-900 text-red-100 border-red-700';
                    case 'grave': return 'bg-orange-900 text-orange-100 border-orange-700';
                    case 'moderado': return 'bg-yellow-900 text-yellow-100 border-yellow-700';
                    case 'mejorado': return 'bg-green-900 text-green-100 border-green-700';
                    case 'leve': return 'bg-blue-900 text-blue-100 border-blue-700';
                    default: return 'bg-gray-700 text-gray-100 border-gray-600';
                }
            };

            const handleExaminePatient = (patient) => {
                setSelectedPatient(patient);
                setCurrentScreen('examination');
                setExaminedAreas([]);
                setShowVisualExam(false);
                setExamFindings({});
                setManualVitalSigns({
                    temp: patient.vitalSigns.temp,
                    pulse: patient.vitalSigns.pulse,
                    respRate: patient.vitalSigns.respRate,
                    bp: patient.vitalSigns.bp
                });
                setPatientStatus('stable');
                setShowDischargeForm(false);
                setShowAdmissionForm(false);
                // Convert patient symptoms to standardized symptoms for the dropdown
                const standardizedSymptoms = [];
                if (patient.symptoms.length === 0) {
                    standardizedSymptoms.push("Sin s√≠ntomas");
                } else {
                    patient.symptoms.forEach(symptom => {
                        if (symptom.includes("axilas") || symptom.includes("axila")) standardizedSymptoms.push("Bubones en axilas");
                        if (symptom.includes("ingles") || symptom.includes("ingle")) standardizedSymptoms.push("Bubones en ingles");
                        if (symptom.includes("cuello")) standardizedSymptoms.push("Bubones en cuello");
                        if (symptom.includes("40¬∞C") || symptom.includes("41¬∞C") || symptom.includes("muy alta")) standardizedSymptoms.push("Fiebre alta (m√°s de 39¬∞C)");
                        else if (symptom.includes("38.5¬∞C") || symptom.includes("38¬∞C") || symptom.includes("moderada")) standardizedSymptoms.push("Fiebre moderada (38-39¬∞C)");
                        else if (symptom.includes("37.8¬∞C") || symptom.includes("leve")) standardizedSymptoms.push("Fiebre leve (37-38¬∞C)");
                        if (symptom.includes("Escalofr√≠os")) standardizedSymptoms.push("Escalofr√≠os severos");
                        if (symptom.includes("Debilidad")) standardizedSymptoms.push("Debilidad extrema");
                        if (symptom.includes("Manchas negras")) standardizedSymptoms.push("Manchas negras en piel");
                        if (symptom.includes("Tos con sangre") || symptom.includes("esputo sanguinolento")) standardizedSymptoms.push("Tos con sangre");
                        if (symptom.includes("Dolor de cabeza")) standardizedSymptoms.push("Dolor de cabeza intenso");
                        if (symptom.includes("N√°useas")) standardizedSymptoms.push("N√°useas");
                        if (symptom.includes("Dolor abdominal")) standardizedSymptoms.push("Dolor abdominal");
                        if (symptom.includes("V√≥mitos")) standardizedSymptoms.push("V√≥mitos");
                        if (symptom.includes("Confusi√≥n")) standardizedSymptoms.push("Confusi√≥n mental");
                        if (symptom.includes("Fatiga")) standardizedSymptoms.push("Fatiga");
                        if (symptom.includes("Dolor de garganta")) standardizedSymptoms.push("Dolor de garganta");
                        if (symptom.includes("Cianosis")) standardizedSymptoms.push("Cianosis");
                        if (symptom.includes("Shock")) standardizedSymptoms.push("Shock s√©ptico");
                        if (symptom.includes("Malestar")) standardizedSymptoms.push("Malestar general");
                        if (symptom.includes("P√©rdida de apetito")) standardizedSymptoms.push("P√©rdida de apetito");
                    });
                }
                setSelectedSymptoms([...new Set(standardizedSymptoms)]);
                setDiagnosis('');
                window.scrollTo(0, 0);
            };

            // ‚úÖ NUEVO handleDischarge con alert + retorno al lobby
            
            const handleDischarge = () => {
                if (selectedPatient) {
                    // Obtener el primer tratamiento (o fallback)
                    const tratamiento = selectedPatient.treatment && selectedPatient.treatment.length > 0
                        ? selectedPatient.treatment[0]
                        : "reposo y seguimiento";
        
                    // ‚úÖ Mostrar mensaje EXACTO solicitado
                    alert(`Paciente ${selectedPatient.name} enviado a casa con ${tratamiento}`);
        
                    // ‚úÖ Registrar como tratado (evitar duplicados)
                    if (!treatedPatients.includes(selectedPatient.id)) {
                        setTreatedPatients(prev => [...prev, selectedPatient.id]);
                        setScore(prev => prev + 40);
                    }
        
                    // ‚úÖ Regresar inmediatamente al lobby (listado actualizado)
                    setCurrentScreen('lobby');
        
                    // ‚úÖ Limpiar estados (sin referenciar dischargedPatient)
                    setSelectedPatient(null);
                    setShowDischargeForm(false);
                    setDischargeReason('');
                    setFollowUp('');
                }
            };


            const examineArea = (area) => {
                if (!examinedAreas.includes(area)) {
                    const newAreas = [...examinedAreas, area];
                    setExaminedAreas(newAreas);
                    const finding = prompt(`Hallazgo en ${area}:`, 'Ej: Bub√≥n palpable, doloroso al tacto...');
                    setExamFindings(prev => ({
                        ...prev,
                        [area]: finding || 'Sin hallazgos relevantes'
                    }));
                }
            };

            const calculateDiagnosis = () => {
                if (selectedSymptoms.includes("Sin s√≠ntomas")) {
                    const temp = parseFloat(manualVitalSigns.temp) || 0;
                    const pulse = parseFloat(manualVitalSigns.pulse) || 0;
                    const respRate = parseFloat(manualVitalSigns.respRate) || 0;
                    const isTempNormal = temp >= 36.0 && temp <= 37.5;
                    const isPulseNormal = pulse >= 60 && pulse <= 100;
                    const isRespNormal = respRate >= 12 && respRate <= 20;
                    if (isTempNormal && isPulseNormal && isRespNormal) {
                        return "Paciente sano - sin patolog√≠a detectable";
                    } else if (temp > 37.5 && temp < 38.5 && isPulseNormal && isRespNormal) {
                        return "Resfriado com√∫n - reposo y hidrataci√≥n";
                    } else if (selectedSymptoms.includes("Dolor de cabeza intenso") && temp <= 37.5) {
                        return "Cefalea tensional - analg√©sicos y reposo";
                    } else if (temp > 38.5 && selectedSymptoms.includes("Dolor de garganta")) {
                        return "Faringitis viral - reposo, hidrataci√≥n y control sintom√°tico";
                    }
                }
                const temp = parseFloat(manualVitalSigns.temp) || 0;
                const symptoms = selectedSymptoms.map(s => s.toLowerCase());
                const hasBubones = symptoms.some(s => /bubones/.test(s));
                const hasManchasNegras = symptoms.some(s => /manchas negras/.test(s));
                const hasTosSangre = symptoms.some(s => /tos con sangre/.test(s));
                const hasFiebre = temp > 38;
                const hasDiarrea = symptoms.some(s => /diarrea con sangre/.test(s));
                const hasEruptivas = symptoms.some(s => /erupci√≥n|p√∫stulas/.test(s));
                const hasLesionesPiel = symptoms.some(s => /entumecimiento|p√©rdida de sensibilidad/.test(s));
                const hasCefaleaFiebre = symptoms.some(s => /dolor de cabeza/.test(s)) && hasFiebre;
                const hasDelirio = symptoms.some(s => /confusi√≥n mental/.test(s));
                if (hasBubones && hasFiebre) {
                    if (hasManchasNegras) return "Peste negra (bub√≥nica con neumon√≠a/sepse)";
                    return "Peste negra (bub√≥nica)";
                }
                if (hasEruptivas && hasFiebre) return "Viruela";
                if (hasTosSangre && hasFiebre && temp > 38.5) return "Tuberculosis";
                if (hasLesionesPiel && symptoms.some(s => /entumecimiento|p√©rdida de sensibilidad/.test(s))) return "Lepra";
                if (hasDiarrea && hasFiebre && temp > 38) return "Disenter√≠a";
                if (hasCefaleaFiebre && hasDelirio && temp > 39) return "Tifus epid√©mico";
                if (symptoms.some(s => /dolor de cabeza/.test(s)) && temp <= 37.5) return "Cefalea tensional";
                if (symptoms.some(s => /dolor de garganta/.test(s)) && temp <= 38.0) return "Faringitis viral";
                if (temp > 38.0 && temp < 39.0 && symptoms.some(s => /tos/.test(s) || /congesti√≥n/.test(s))) return "Resfriado com√∫n";
                if (symptoms.some(s => /fatiga|malestar general/.test(s)) && temp <= 37.5) return "S√≠ndrome de fatiga - reposo recomendado";
                return "Diagn√≥stico no concluyente ‚Äì requiere m√°s datos";
            };

            const assessPatientStatus = () => {
                if (selectedSymptoms.includes("Sin s√≠ntomas")) {
                    const temp = parseFloat(manualVitalSigns.temp) || 0;
                    const pulse = parseFloat(manualVitalSigns.pulse) || 0;
                    const respRate = parseFloat(manualVitalSigns.respRate) || 0;
                    const bpParts = manualVitalSigns.bp ? manualVitalSigns.bp.split('/') : [];
                    const systolic = bpParts.length > 0 ? parseFloat(bpParts[0]) : 0;
                    const isTempNormal = temp >= 36.0 && temp <= 37.5;
                    const isPulseNormal = pulse >= 60 && pulse <= 100;
                    const isRespNormal = respRate >= 12 && respRate <= 20;
                    const isBPNormal = systolic >= 100 && systolic <= 140;
                    if (isTempNormal && isPulseNormal && isRespNormal && isBPNormal) {
                        return 'improved';
                    }
                }
                const temp = parseFloat(manualVitalSigns.temp) || 0;
                const pulse = parseFloat(manualVitalSigns.pulse) || 0;
                const bpParts = manualVitalSigns.bp ? manualVitalSigns.bp.split('/') : [];
                const systolic = bpParts.length > 0 ? parseFloat(bpParts[0]) : 0;
                const hasFever = temp > 38;
                const hasHighPulse = pulse > 100;
                const hasLowBP = systolic < 90;
                const seriousSymptoms = selectedSymptoms.filter(symptom => 
                    symptom !== "Sin s√≠ntomas" &&
                    (symptom.includes("severos") || 
                    symptom.includes("extrema") || 
                    symptom.includes("negras") || 
                    symptom.includes("shock") || 
                    symptom.includes("cianosis") || 
                    symptom.includes("confusi√≥n"))
                ).length;
                if (temp < 37.5 && pulse < 90 && systolic > 100 && seriousSymptoms === 0) {
                    return 'improved';
                }
                if ((temp > 39.5 || hasLowBP) && hasHighPulse && seriousSymptoms > 2) {
                    return 'worsened';
                }
                return 'stable';
            };

            useEffect(() => {
                const newDiagnosis = calculateDiagnosis();
                setDiagnosis(newDiagnosis);
                const newStatus = assessPatientStatus();
                setPatientStatus(newStatus);
            }, [manualVitalSigns, selectedSymptoms]);

            const toggleSymptom = (symptom) => {
                if (symptom === "Sin s√≠ntomas") {
                    if (!selectedSymptoms.includes("Sin s√≠ntomas")) {
                        setSelectedSymptoms(["Sin s√≠ntomas"]);
                    } else {
                        setSelectedSymptoms([]);
                    }
                } else {
                    let newSymptoms = selectedSymptoms.filter(s => s !== "Sin s√≠ntomas");
                    if (newSymptoms.includes(symptom)) {
                        newSymptoms = newSymptoms.filter(s => s !== symptom);
                    } else {
                        newSymptoms.push(symptom);
                    }
                    setSelectedSymptoms(newSymptoms);
                }
            };

            const handleAdmission = () => {
                if (admissionDiagnosis && treatmentPlan.length > 0) {
                    if (admissionDiagnosis.includes("cr√≠tico") || admissionDiagnosis.includes("grave") || admissionDiagnosis.includes("sepsis")) {
                        setPatientStatus('worsened');
                    } else {
                        setPatientStatus('stable');
                    }
                    setShowAdmissionForm(false);
                    setScore(score + 25);
                }
            };

            const getStatusColor = (status) => {
                switch(status) {
                    case 'improved': return 'status-improved';
                    case 'worsened': return 'status-worsened';
                    default: return 'status-stable';
                }
            };

            const renderLobby = () => (
                <div className="min-h-screen bg-gradient-to-b from-amber-950 to-stone-900 p-6">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-amber-900 border-4 border-amber-700 rounded-lg p-8 mb-6 shadow-2xl">
                            <h1 className="text-4xl font-bold text-amber-100 mb-2 text-center">
                                üè∞ Hospital de la Peste Negra
                            </h1>
                            <p className="text-amber-200 text-center text-lg">
                                Europa, A√±o del Se√±or 1347 - Con Tecnolog√≠a Moderna
                            </p>
                            <div className="flex justify-center gap-8 mt-4">
                                <div className="text-center">
                                    <p className="text-amber-300 text-sm">Pacientes Tratados</p>
                                    <p className="text-3xl font-bold text-amber-100">{treatedPatients.length}/{patients.length}</p>
                                </div>
                                <div className="text-center">
                                    <p className="text-amber-300 text-sm">Puntuaci√≥n</p>
                                    <p className="text-3xl font-bold text-green-400">{score}</p>
                                </div>
                            </div>
                        </div>
                        <div className="bg-stone-800 border-4 border-stone-700 rounded-lg p-6 mb-6">
                            <div className="flex items-center gap-3 mb-4">
                                <Users size={32} className="text-amber-400" />
                                <h2 className="text-2xl font-bold text-amber-100">Sala del Hospital</h2>
                            </div>
                            <p className="text-stone-300 mb-4">
                                Eres un m√©dico en el Hospital de San Juan. Los enfermos de la peste negra llenan las salas. 
                                Con la tecnolog√≠a moderna, puedes salvarlos. Examina a cada paciente y administra el tratamiento adecuado.
                            </p>
                            <p className="text-stone-300 italic">
                                <strong>Instrucciones:</strong> Eval√∫a a cada paciente, determina su estado actual y decide si dar el alta o ingresar para tratamiento.
                            </p>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {patients.map(patient => (
                                <div 
                                    key={patient.id}
                                    className={`border-4 rounded-lg p-4 cursor-pointer transform transition-all hover:scale-105 hover:shadow-2xl ${
                                        treatedPatients.includes(patient.id) 
                                        ? 'bg-green-900 border-green-700 opacity-75' 
                                        : 'bg-stone-800 border-stone-600 pulse'
                                    }`}
                                    onClick={() => handleExaminePatient(patient)}
                                >
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <h3 className="text-xl font-bold text-amber-100">{patient.name}</h3>
                                            <p className="text-stone-400 text-sm">{patient.age} a√±os - {patient.occupation}</p>
                                        </div>
                                        {treatedPatients.includes(patient.id) && (
                                            <span className="text-green-400 text-2xl">‚úì</span>
                                        )}
                                    </div>
                                    <div className={`inline-block px-3 py-1 rounded-full text-sm font-bold mb-3 border-2 ${getSeverityColor(patient.severity)}`}>
                                        {patient.severity.toUpperCase()}
                                    </div>
                                    <div className="space-y-2">
                                        <div className="flex items-center gap-2 text-stone-300">
                                            <Thermometer size={16} className="text-red-400" />
                                            <span className="text-sm">{patient.vitalSigns.temp}¬∞C</span>
                                        </div>
                                        <div className="flex items-center gap-2 text-stone-300">
                                            <Activity size={16} className="text-blue-400" />
                                            <span className="text-sm">{patient.vitalSigns.pulse} lpm</span>
                                        </div>
                                    </div>
                                    <button className="w-full mt-4 bg-amber-700 hover:bg-amber-600 text-amber-100 font-bold py-2 px-4 rounded transition-colors border-2 border-amber-900">
                                        {treatedPatients.includes(patient.id) ? 'Ver Registro' : 'Examinar Paciente'}
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const renderExamination = () => (
                <div className="min-h-screen bg-gradient-to-b from-stone-900 to-black p-6">
                    <div className="max-w-6xl mx-auto">
                        <button 
                            onClick={() => {
                                setCurrentScreen('lobby');
                                setExaminedAreas([]);
                                setShowVisualExam(false);
                                setExamFindings({});
                                setSelectedPatient(null);
                            }}
                            className="flex items-center gap-2 bg-stone-700 hover:bg-stone-600 text-stone-100 font-bold py-2 px-4 rounded mb-6 transition-colors"
                        >
                            <ArrowLeft size={20} />
                            Volver a la Sala
                        </button>
                        <div className="exam-animation">
                            <div className="examination-intro">
                                <h3 className="text-xl font-bold">Examen del Paciente</h3>
                                <p><strong>Paciente:</strong> {selectedPatient.name}, {selectedPatient.age} a√±os, {selectedPatient.gender}, {selectedPatient.occupation}</p>
                                <p><strong>Estado inicial:</strong> <span className={`status-tag ${getSeverityColor(selectedPatient.severity).split(' ')[0]}`}>{selectedPatient.severity}</span> ({selectedPatient.prognosis})</p>
                                <p className="italic">Realice una evaluaci√≥n completa para determinar el diagn√≥stico y decidir el curso de acci√≥n.</p>
                            </div>
                        </div>
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div className="bg-stone-800 border-4 border-stone-700 rounded-lg p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold text-amber-100">Examen F√≠sico</h2>
                                    <button
                                        onClick={() => setShowVisualExam(!showVisualExam)}
                                        className="bg-amber-700 hover:bg-amber-600 text-amber-100 px-4 py-2 rounded font-bold transition-colors"
                                    >
                                        {showVisualExam ? 'Ver Datos' : 'Examinar Visualmente'}
                                    </button>
                                </div>
                                {!showVisualExam ? (
                                    <div className="bg-stone-900 rounded-lg p-6 min-h-96">
                                        <h3 className="text-xl font-bold text-amber-100 mb-4">{selectedPatient.name}</h3>
                                        <p className="text-stone-400 mb-4">{selectedPatient.age} a√±os - {selectedPatient.gender}</p>
                                        <div className="space-y-4">
                                            <p className="text-stone-300">
                                                El paciente se encuentra en una cama del hospital, vestido con ropas medievales simples.
                                                Presenta signos evidentes de malestar y sufre de la peste que azota Europa.
                                            </p>
                                            <div className="bg-amber-950 border-2 border-amber-800 rounded p-3">
                                                <p className="text-amber-200 text-sm">
                                                    üí° <strong>Procedimiento de examen:</strong> Primero revise los signos vitales y s√≠ntomas, luego realice el examen f√≠sico visual.
                                                </p>
                                            </div>
                                            <div className="bg-stone-800 border-l-4 border-blue-500 p-3 rounded">
                                                <h4 className="font-bold text-blue-300 mb-2">Pasos recomendados:</h4>
                                                <ol className="text-stone-300 list-decimal list-inside space-y-1">
                                                    <li>Verifique los signos vitales</li>
                                                    <li>Registre los s√≠ntomas presentes</li>
                                                    <li>Realice el examen visual del cuerpo</li>
                                                    <li>Eval√∫e el estado actual del paciente</li>
                                                    <li>Decida: Dar alta o ingresar para tratamiento</li>
                                                </ol>
                                            </div>
                                            {examinedAreas.length > 0 && (
                                                <div className="mt-4">
                                                    <h4 className="text-lg font-bold text-green-400 mb-2">√Åreas Examinadas:</h4>
                                                    <div className="flex flex-wrap gap-2">
                                                        {examinedAreas.map((area, idx) => (
                                                            <span key={idx} className="bg-green-900 text-green-100 px-3 py-1 rounded-full text-sm border border-green-700">
                                                                ‚úì {area}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-stone-900 rounded-lg p-4 relative">
                                        <div className="relative w-full h-96 bg-stone-800 rounded-lg border-2 border-stone-700 flex items-center justify-center">
                                            <svg viewBox="0 0 200 400" className="w-full h-full">
                                                <ellipse cx="100" cy="50" rx="25" ry="30" fill="#8B7355" stroke="#6B5644" strokeWidth="2"/>
                                                <g 
                                                    onClick={() => examineArea('Cuello')}
                                                    className="cursor-pointer hover:opacity-80 transition-opacity"
                                                >
                                                    <rect x="90" y="75" width="20" height="25" fill="#8B7355" stroke="#6B5644" strokeWidth="2"/>
                                                    {examinedAreas.includes('Cuello') && (
                                                        <circle cx="100" cy="85" r="15" fill="none" stroke="#22c55e" strokeWidth="2" strokeDasharray="3,3"/>
                                                    )}
                                                </g>
                                                <rect x="70" y="100" width="60" height="100" fill="#654321" stroke="#4A3218" strokeWidth="2" rx="5"/>
                                                <rect x="40" y="110" width="25" height="80" fill="#8B7355" stroke="#6B5644" strokeWidth="2" rx="5"/>
                                                <rect x="135" y="110" width="25" height="80" fill="#8B7355" stroke="#6B5644" strokeWidth="2" rx="5"/>
                                                <g 
                                                    onClick={() => examineArea('Axila Izquierda')}
                                                    className="cursor-pointer hover:opacity-80 transition-opacity"
                                                >
                                                    <circle cx="65" cy="115" r="12" fill="#8B7355" opacity="0.5"/>
                                                    {examinedAreas.includes('Axila Izquierda') && (
                                                        <circle cx="65" cy="115" r="18" fill="none" stroke="#22c55e" strokeWidth="2" strokeDasharray="3,3"/>
                                                    )}
                                                </g>
                                                <g 
                                                    onClick={() => examineArea('Axila Derecha')}
                                                    className="cursor-pointer hover:opacity-80 transition-opacity"
                                                >
                                                    <circle cx="135" cy="115" r="12" fill="#8B7355" opacity="0.5"/>
                                                    {examinedAreas.includes('Axila Derecha') && (
                                                        <circle cx="135" cy="115" r="18" fill="none" stroke="#22c55e" strokeWidth="2" strokeDasharray="3,3"/>
                                                    )}
                                                </g>
                                                <rect x="75" y="200" width="22" height="100" fill="#654321" stroke="#4A3218" strokeWidth="2" rx="5"/>
                                                <rect x="103" y="200" width="22" height="100" fill="#654321" stroke="#4A3218" strokeWidth="2" rx="5"/>
                                                <g 
                                                    onClick={() => examineArea('Ingle Izquierda')}
                                                    className="cursor-pointer hover:opacity-80 transition-opacity"
                                                >
                                                    <circle cx="86" cy="205" r="12" fill="#8B7355" opacity="0.5"/>
                                                    {examinedAreas.includes('Ingle Izquierda') && (
                                                        <circle cx="86" cy="205" r="18" fill="none" stroke="#22c55e" strokeWidth="2" strokeDasharray="3,3"/>
                                                    )}
                                                </g>
                                                <g 
                                                    onClick={() => examineArea('Ingle Derecha')}
                                                    className="cursor-pointer hover:opacity-80 transition-opacity"
                                                >
                                                    <circle cx="114" cy="205" r="12" fill="#8B7355" opacity="0.5"/>
                                                    {examinedAreas.includes('Ingle Derecha') && (
                                                        <circle cx="114" cy="205" r="18" fill="none" stroke="#22c55e" strokeWidth="2" strokeDasharray="3,3"/>
                                                    )}
                                                </g>
                                                <ellipse cx="86" cy="310" rx="12" ry="8" fill="#654321" stroke="#4A3218" strokeWidth="2"/>
                                                <ellipse cx="114" cy="310" rx="12" ry="8" fill="#654321" stroke="#4A3218" strokeWidth="2"/>
                                            </svg>
                                        </div>
                                        <div className="mt-4 bg-amber-950 border-2 border-amber-800 rounded p-3">
                                            <p className="text-amber-200 text-sm">
                                                üîç <strong>Examen f√≠sico:</strong> Haz clic en las √°reas del cuerpo para examinarlas detalladamente.
                                            </p>
                                        </div>
                                        {examinedAreas.length > 0 && (
                                            <div className="mt-4 bg-stone-800 rounded p-4">
                                                <h4 className="text-lg font-bold text-amber-100 mb-3">Hallazgos del Examen:</h4>
                                                {examinedAreas.map((area, idx) => (
                                                    <div key={idx} className="mb-2 p-2 bg-stone-900 rounded border-l-4 border-red-600">
                                                        <p className="text-stone-300">
                                                            <strong className="text-amber-400">{area}:</strong>{' '}
                                                            {examFindings[area] || 'No descrito'}
                                                        </p>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                            <div className="space-y-4">
                                <div className="bg-stone-800 border-4 border-stone-700 rounded-lg p-6">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <h1 className="text-2xl font-bold text-amber-100 mb-2">{selectedPatient.name}</h1>
                                            <p className="text-stone-400">{selectedPatient.age} a√±os - {selectedPatient.gender} - {selectedPatient.occupation}</p>
                                        </div>
                                        <div className={`px-4 py-2 rounded-full font-bold border-2 ${getSeverityColor(patientStatus)}`}>
                                            {patientStatus === 'improved' ? 'MEJORADO' : 
                                             patientStatus === 'worsened' ? 'EMPEORADO' : 'ESTABLE'}
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-stone-800 border-4 border-stone-700 rounded-lg p-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Activity className="text-blue-400" size={24} />
                                        <h3 className="text-xl font-bold text-amber-100">Signos Vitales</h3>
                                    </div>
                                    <div className="space-y-3">
                                        {Object.entries(manualVitalSigns).map(([key, value]) => (
                                            <div key={key} className="flex justify-between items-center bg-stone-900 p-2 rounded">
                                                <span className="text-stone-400">
                                                    {key === 'temp' && 'Temperatura (¬∞C)'}
                                                    {key === 'pulse' && 'Pulso (lpm)'}
                                                    {key === 'respRate' && 'Frec. Respiratoria'}
                                                    {key === 'bp' && 'Presi√≥n Arterial'}
                                                </span>
                                                <input
                                                    type="text"
                                                    value={value}
                                                    onChange={(e) => setManualVitalSigns({...manualVitalSigns, [key]: e.target.value})}
                                                    className="bg-stone-800 text-amber-100 w-24 text-right border border-stone-600 rounded px-2 py-1"
                                                />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="bg-stone-800 border-4 border-stone-700 rounded-lg p-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Stethoscope className="text-red-400" size={24} />
                                        <h3 className="text-xl font-bold text-amber-100">S√≠ntomas Reportados</h3>
                                    </div>
                                    <div className="dropdown">
                                        <button 
                                            className="dropdown-button"
                                            onClick={() => setShowSymptomDropdown(!showSymptomDropdown)}
                                        >
                                            <span>
                                                {selectedSymptoms.length > 0 
                                                    ? `Seleccionados: ${selectedSymptoms.length}` 
                                                    : "Seleccionar s√≠ntomas..."}
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                        </button>
                                        {showSymptomDropdown && (
                                            <div className="dropdown-menu">
                                                {allSymptoms.map((symptom, idx) => (
                                                    <div 
                                                        key={idx}
                                                        className={`dropdown-item ${selectedSymptoms.includes(symptom) ? 'selected' : ''}`}
                                                        onClick={() => toggleSymptom(symptom)}
                                                    >
                                                        {selectedSymptoms.includes(symptom) && "‚úì "}
                                                        {symptom}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    {selectedSymptoms.length > 0 && (
                                        <div className="symptom-tags mt-3">
                                            {selectedSymptoms.map((symptom, idx) => (
                                                <div key={idx} className="symptom-tag">
                                                    {symptom}
                                                    <span 
                                                        className="symptom-tag-remove"
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            toggleSymptom(symptom);
                                                        }}
                                                    >
                                                        √ó
                                                    </span>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <div className="severity-assessment">
                                    <h4 className="font-bold text-xl">Evaluaci√≥n de Estado</h4>
                                    <p className="text-stone-300 mb-2">
                                        Basado en los signos vitales y s√≠ntomas, el estado actual del paciente es:
                                    </p>
                                    <div className={`px-3 py-1 rounded-full inline-block font-bold ${getStatusColor(patientStatus)}`}>
                                        {patientStatus === 'improved' ? 'MEJORADO' : 
                                         patientStatus === 'worsened' ? 'EMPEORADO' : 'ESTABLE'}
                                    </div>
                                    <div className="severity-indicators">
                                        <div className={`indicator ${patientStatus}`}>
                                            {patientStatus === 'improved' && '‚úì Signos vitales estables y mejor√≠a cl√≠nica'}
                                            {patientStatus === 'stable' && '‚Üí Estado estable, requiere observaci√≥n'}
                                            {patientStatus === 'worsened' && '‚ö† Estado cr√≠tico, requiere intervenci√≥n inmediata'}
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-amber-950 border-2 border-amber-800 rounded-lg p-4">
                                    <div className="flex items-center gap-2 mb-3">
                                        <ClipboardList className="text-amber-400" size={24} />
                                        <h3 className="text-xl font-bold text-amber-100">Diagn√≥stico</h3>
                                    </div>
                                    <p className="text-amber-200">
                                        <strong>Diagn√≥stico:</strong> {diagnosis}
                                    </p>
                                </div>

                                {/* Decision buttons ‚Äî ahora sin dischargedPatient check */}
                                {!treatedPatients.includes(selectedPatient.id) && (
                                    <div className="decision-buttons">
                                        <button 
                                            onClick={() => setShowDischargeForm(true)}
                                            disabled={patientStatus !== 'improved'}
                                            className={`btn-discharge ${patientStatus !== 'improved' ? 'opacity-50 cursor-not-allowed' : ''}`}
                                        >
                                            Dar Alta
                                        </button>
                                        <button 
                                            onClick={() => setShowAdmissionForm(true)}
                                            disabled={patientStatus === 'improved'}
                                            className={`btn-admit ${patientStatus === 'improved' ? 'opacity-50 cursor-not-allowed' : ''}`}
                                        >
                                            Ingresar
                                        </button>
                                    </div>
                                )}

                                {showDischargeForm && patientStatus === 'improved' && (
                                    <div className="discharge-form">
                                        <h4 className="font-bold text-xl">Formulario de Alta</h4>
                                        <div className="form-group">
                                            <label>Motivo del alta:</label>
                                            <input 
                                                type="text" 
                                                value={dischargeReason}
                                                onChange={(e) => setDischargeReason(e.target.value)}
                                                placeholder="Ej: Mejor√≠a cl√≠nica, signos vitales normales..."
                                                className="mt-1"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>Seguimiento recomendado:</label>
                                            <textarea 
                                                value={followUp}
                                                onChange={(e) => setFollowUp(e.target.value)}
                                                placeholder="Ej: Reposo 3 d√≠as, hidrataci√≥n, control en 48h..."
                                                className="mt-1"
                                                rows="2"
                                            />
                                        </div>
                                        <button 
                                            onClick={handleDischarge}
                                            className="w-full bg-green-700 hover:bg-green-600 text-green-100 font-bold py-2 px-4 rounded mt-2 transition-colors"
                                        >
                                            Confirmar Alta
                                        </button>
                                    </div>
                                )}

                                {showAdmissionForm && patientStatus !== 'improved' && (
                                    <div className="admission-form">
                                        <h4 className="font-bold text-xl">Formulario de Ingreso</h4>
                                        <div className="form-group">
                                            <label>Diagn√≥stico de ingreso:</label>
                                            <input 
                                                type="text" 
                                                value={admissionDiagnosis}
                                                onChange={(e) => setAdmissionDiagnosis(e.target.value)}
                                                placeholder="Ej: Peste bub√≥nica grave..."
                                                className="mt-1"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>Plan de tratamiento:</label>
                                            <div className="treatment-plan">
                                                <div className="treatment-items">
                                                    {selectedPatient.treatment.map((treatment, idx) => (
                                                        <div key={idx} className="treatment-item">
                                                            {treatment}
                                                        </div>
                                                    ))}
                                                </div>
                                                <button 
                                                    onClick={() => {
                                                        if (selectedPatient.treatment && selectedPatient.treatment.length > 0) {
                                                            setTreatmentPlan(selectedPatient.treatment);
                                                        }
                                                    }}
                                                    className="mt-2 bg-amber-700 hover:bg-amber-600 text-amber-100 px-3 py-1 rounded text-sm"
                                                >
                                                    Cargar plan sugerido
                                                </button>
                                            </div>
                                        </div>
                                        <button 
                                            onClick={handleAdmission}
                                            disabled={!admissionDiagnosis || treatmentPlan.length === 0}
                                            className="w-full bg-red-700 hover:bg-red-600 text-red-100 font-bold py-2 px-4 rounded mt-2 transition-colors"
                                        >
                                            Confirmar Ingreso
                                        </button>
                                    </div>
                                )}

                                {treatedPatients.includes(selectedPatient.id) && (
                                    <div className="bg-green-900 border-2 border-green-700 rounded-lg p-4 text-center">
                                        <p className="text-green-100 text-xl font-bold">
                                            {patientStatus === 'improved' ? '‚úì Paciente dado de alta' : '‚úì Paciente ingresado'}
                                        </p>
                                        <p className="text-green-300 mt-2">
                                            {patientStatus === 'improved' 
                                                ? 'El paciente ha sido dado de alta con instrucciones de seguimiento.'
                                                : 'El paciente ha sido ingresado para tratamiento especializado.'}
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="font-sans">
                    {currentScreen === 'lobby' && renderLobby()}
                    {currentScreen === 'examination' && selectedPatient && renderExamination()}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<PlagueHospitalGame />);
    </script>
</body>
</html>